<!doctype html>
<html lang="zh-TW">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å‹•ç•«ç®¡ç†ç³»çµ±</title>
  <style>
        body {
            box-sizing: border-box;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            width: 100%;
        }

        body {
            font-family: 'Noto Sans TC', 'Microsoft JhengHei', sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 100%);
            color: #e0e0e0;
            overflow-x: hidden;
        }

        :root {
            --primary: #00d4ff;
            --primary-dark: #00a8cc;
            --secondary: #ff6b9d;
            --success: #4caf50;
            --danger: #f44336;
            --warning: #ffc107;
            --background: #16213e;
            --surface: #1e2a47;
            --text: #e0e0e0;
            --text-dim: #9ca3af;
            --border: #2d3b5a;
            --shadow: rgba(0, 0, 0, 0.5);
            --gold: #ffd700;
            --gold-dark: #ffb300;
        }

        .app-container {
            width: 100%;
            height: 100%;
            overflow-y: auto;
            padding: 20px;
        }

        /* ========== Custom Scrollbar ========== */
        .custom-scroll::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        .custom-scroll::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
        }

        .custom-scroll::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        .custom-scroll::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }

        /* ========== Header ========== */
        .header {
            background: var(--surface);
            padding: 20px 30px;
            border-radius: 16px;
            box-shadow: 0 4px 20px var(--shadow);
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .header h1 {
            font-size: 28px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 188, 212, 0.3);
        }

        .btn-secondary {
            background: var(--secondary);
            color: white;
        }

        .btn-secondary:hover {
            background: #ee5a5a;
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        /* ========== Search & Filter ========== */
        .controls {
            background: var(--surface);
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 4px 20px var(--shadow);
            margin-bottom: 25px;
        }

        .search-bar {
            display: flex;
            gap: 12px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .search-bar input {
            flex: 1;
            min-width: 250px;
            padding: 12px 18px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 15px;
            transition: all 0.3s ease;
            background: #0a0e1a;
            color: #e0e0e0;
        }

        .search-bar input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 188, 212, 0.1);
        }

        .filter-selects {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-bottom: 15px;
        }

        .filter-selects select {
            padding: 10px 16px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: #0a0e1a;
            color: #e0e0e0;
            cursor: pointer;
        }

        .filter-selects select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 188, 212, 0.1);
        }

        /* ========== Grid Layout ========== */
        .anime-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .anime-card {
            background: var(--surface);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 20px var(--shadow);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .anime-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
        }

        .recommendation-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(135deg, #ffd700 0%, #ffb300 100%);
            color: #1a1a2e;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(255, 215, 0, 0.4);
            z-index: 10;
            animation: badgePulse 2s ease-in-out infinite;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        @keyframes badgePulse {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 4px 12px rgba(255, 215, 0, 0.4);
            }
            50% {
                transform: scale(1.05);
                box-shadow: 0 6px 20px rgba(255, 215, 0, 0.6);
            }
        }

        .anime-card-poster {
            width: 100%;
            padding: 15px 15px 0 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            background: var(--surface);
        }

        .anime-card img {
            width: 100%;
            height: auto;
            max-height: 280px;
            object-fit: contain;
            border-radius: 8px;
            background: linear-gradient(135deg, #2a2a3e 0%, #3a3a4e 100%);
        }

        .anime-card-content {
            padding: 15px;
        }

        .anime-card-title {
            font-size: 15px;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--text);
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            min-height: 42px;
        }

        .anime-card-meta {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .meta-row {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            flex-wrap: wrap;
        }

        .meta-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-year {
            background: rgba(0, 188, 212, 0.15);
            color: var(--primary);
        }

        .badge-rating {
            background: rgba(255, 215, 0, 0.2);
            color: var(--gold-dark);
        }

        .badge-recommendation {
            background: rgba(255, 107, 157, 0.2);
            color: var(--secondary);
        }

        .no-poster {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: #666;
            background: linear-gradient(135deg, #2a2a3e 0%, #3a3a4e 100%);
            width: 100%;
            height: 280px;
            border-radius: 8px;
        }

        /* ========== Detail Modal ========== */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow-y: auto;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: var(--surface);
            border-radius: 20px;
            max-width: 900px;
            width: 100%;
            max-height: 90%;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.1);
            border: none;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 10;
            color: white;
        }

        .modal-close:hover {
            background: var(--danger);
            color: white;
            transform: rotate(90deg);
        }

        .detail-header {
            display: flex;
            gap: 25px;
            padding: 30px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        }

        .detail-poster {
            flex-shrink: 0;
        }

        .detail-poster img {
            width: 220px;
            height: 300px;
            object-fit: cover;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
            background: linear-gradient(135deg, #2a2a3e 0%, #3a3a4e 100%);
        }

        .detail-info {
            flex: 1;
            min-width: 0;
        }

        .detail-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 18px;
            line-height: 1.3;
        }

        .detail-meta-row {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 10px;
        }

        .detail-meta-item {
            padding: 6px 14px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .meta-gold {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2) 0%, rgba(218, 165, 32, 0.2) 100%);
            color: var(--gold-dark);
            border: 1.5px solid var(--gold);
        }

        .meta-recommendation {
            background: linear-gradient(135deg, #ffd700 0%, #ffb300 100%);
            color: #1a1a2e;
            border: 2px solid rgba(255, 255, 255, 0.5);
            font-size: 18px;
            padding: 10px 18px;
            box-shadow: 0 4px 20px rgba(255, 215, 0, 0.5);
            animation: starShine 3s ease-in-out infinite;
            font-weight: 800;
            letter-spacing: 2px;
        }

        @keyframes starShine {
            0%, 100% {
                box-shadow: 0 4px 20px rgba(255, 215, 0, 0.5);
                transform: scale(1);
            }
            50% {
                box-shadow: 0 6px 30px rgba(255, 215, 0, 0.8), 0 0 40px rgba(255, 215, 0, 0.4);
                transform: scale(1.05);
            }
        }

        .meta-cyan {
            background: rgba(0, 188, 212, 0.15);
            color: var(--primary);
            border: 1.5px solid var(--primary);
            width: 100%;
        }
        
        .meta-cyan.long-text {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .detail-description {
            padding: 30px;
            border-top: 1px solid var(--border);
        }

        .detail-description h3 {
            font-size: 18px;
            color: var(--text);
            margin-bottom: 12px;
        }

        .description-content {
            max-height: 150px;
            overflow-y: auto;
            line-height: 1.8;
            color: var(--text-dim);
            font-size: 15px;
            padding-right: 10px;
        }

        .detail-links {
            padding: 30px;
            border-top: 1px solid var(--border);
        }

        .detail-links h3 {
            font-size: 18px;
            color: var(--text);
            margin-bottom: 15px;
        }

        .links-container {
            max-height: 120px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .links-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
        }

        .link-item {
            padding: 12px 16px;
            background: var(--background);
            border: 2px solid var(--border);
            border-radius: 10px;
            text-decoration: none;
            color: var(--primary);
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .link-item:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        /* ========== Admin Panel ========== */
        .admin-panel {
            background: var(--surface);
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 4px 20px var(--shadow);
            margin-bottom: 25px;
        }

        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            border-bottom: 2px solid var(--border);
            flex-wrap: wrap;
        }

        .admin-tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            color: var(--text-dim);
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .admin-tab:hover {
            color: var(--primary);
        }

        .admin-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text);
            font-size: 14px;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.3s ease;
            background: #0a0e1a;
            color: #e0e0e0;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 188, 212, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        /* ========== Options Management ========== */
        .options-section {
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 188, 212, 0.05);
            border: 2px solid var(--border);
            border-radius: 12px;
        }

        .options-section h3 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 16px;
        }

        .options-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }

        .option-tag {
            padding: 8px 16px;
            background: var(--background);
            border: 2px solid var(--border);
            border-radius: 20px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }

        .option-tag-remove {
            cursor: pointer;
            color: var(--danger);
            font-weight: bold;
            transition: transform 0.2s;
        }

        .option-tag-remove:hover {
            transform: scale(1.3);
        }

        .add-option-form {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .add-option-form input {
            flex: 1;
            padding: 10px 16px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 14px;
            background: #0a0e1a;
            color: #e0e0e0;
        }

        /* ========== Table View ========== */
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        .data-table th {
            background: var(--primary);
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .data-table td {
            padding: 12px;
            border-bottom: 1px solid var(--border);
        }

        .data-table tbody tr:hover {
            background: rgba(0, 188, 212, 0.05);
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 6px;
        }

        /* ========== Toast ========== */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--surface);
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 12px;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 2000;
            max-width: 400px;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            border-left: 4px solid var(--success);
        }

        .toast.error {
            border-left: 4px solid var(--danger);
        }

        .toast-icon {
            font-size: 24px;
        }

        .toast-message {
            font-size: 14px;
            color: var(--text);
            font-weight: 500;
        }

        /* ========== Loading Spinner ========== */
        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ========== Empty State ========== */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-dim);
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state-text {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .empty-state-hint {
            font-size: 14px;
            color: var(--text-dim);
        }

        /* ========== Login Screen ========== */
        .login-screen {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100%;
            padding: 20px;
        }

        .login-box {
            background: var(--surface);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            max-width: 400px;
            width: 100%;
            text-align: center;
        }

        .login-box h2 {
            color: var(--primary);
            margin-bottom: 30px;
            font-size: 28px;
        }

        .login-box input {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 15px;
            margin-bottom: 20px;
            background: #0a0e1a;
            color: #e0e0e0;
        }

        .login-box input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 188, 212, 0.1);
        }

        /* ========== Responsive ========== */
        @media (max-width: 768px) {
            .header {
                padding: 15px 20px;
            }

            .header h1 {
                font-size: 22px;
            }

            .anime-grid {
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
                gap: 12px;
            }

            .anime-card img {
                max-height: 200px;
            }

            .detail-header {
                flex-direction: column;
                padding: 20px;
            }

            .detail-poster img {
                width: 100%;
                height: auto;
            }

            .detail-title {
                font-size: 22px;
            }

            .admin-tabs {
                overflow-x: auto;
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }

        /* ========== Utility Classes ========== */
        .mt-20 { margin-top: 20px; }
        .mb-20 { margin-bottom: 20px; }
        .text-center { text-align: center; }
        .hidden { display: none; }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="app-container" id="app"><!-- åˆå§‹åŒ–è¼‰å…¥ä¸­ -->
   <div style="text-align: center; padding: 100px 20px;">
    <div class="loading-spinner" style="width: 48px; height: 48px; border-width: 4px; margin: 0 auto 20px;"></div>
    <div style="color: white; font-size: 18px; font-weight: 600;">
     ç³»çµ±è¼‰å…¥ä¸­...
    </div>
   </div>
  </div><!-- Detail Modal -->
  <div class="modal-overlay" id="detailModal">
   <div class="modal-content"><button class="modal-close" onclick="closeAnimeDetail()">âœ•</button>
    <div id="detailContent"></div>
   </div>
  </div><!-- Toast Notification -->
  <div class="toast" id="toast"><span class="toast-icon" id="toastIcon">âœ…</span> <span class="toast-message" id="toastMessage"></span>
  </div>
  <script>
// âœ… æœ¬åœ° dataSdk æ›¿èº« - é€™æ˜¯ä½ éœ€è¦ä¿ç•™çš„ç¨‹å¼ç¢¼
window.dataSdk = {
    _data: JSON.parse(localStorage.getItem('animeData') || '[]'),

    init() {
        // åœ¨é€™è£¡å¯ä»¥åŠ å…¥ä¸€äº›åˆå§‹åŒ–æª¢æŸ¥ï¼Œä½†ç›®å‰ Promise.resolve(true) å³å¯
        return Promise.resolve({ isOk: true });
    },

    // å–å¾—æ‰€æœ‰è³‡æ–™
    getAll() {
        return Promise.resolve(this._data);
    },

    // å»ºç«‹æ–°è³‡æ–™
    create(item) {
        const id = this._data.length ? Math.max(...this._data.map(a => a.id || 0)) + 1 : 1;
        // ç¢ºä¿ __backendId æ˜¯å­—ä¸²ï¼Œç¬¦åˆä½ åŸæœ¬ä»£ç¢¼çš„é æœŸ
        const newItem = { ...item, id, __backendId: id.toString() }; 
        this._data.push(newItem);
        // å„²å­˜åˆ°ç€è¦½å™¨çš„æœ¬åœ°å„²å­˜ç©ºé–“
        localStorage.setItem('animeData', JSON.stringify(this._data));
        return Promise.resolve({ isOk: true, data: newItem });
    },

    // æ›´æ–°è³‡æ–™
    update(updatedItem) {
        const index = this._data.findIndex(a => a.__backendId === updatedItem.__backendId);
        if (index === -1) return Promise.resolve({ isOk: false, error: { message: 'æ‰¾ä¸åˆ°å‹•ç•«è³‡æ–™' } });

        this._data[index] = { ...this._data[index], ...updatedItem };
        localStorage.setItem('animeData', JSON.stringify(this._data));
        return Promise.resolve({ isOk: true, data: this._data[index] });
    },

    // åˆªé™¤è³‡æ–™
    delete(item) {
        const index = this._data.findIndex(a => a.__backendId === item.__backendId);
        if (index === -1) return Promise.resolve({ isOk: false, error: { message: 'æ‰¾ä¸åˆ°å‹•ç•«è³‡æ–™' } });

        this._data.splice(index, 1);
        localStorage.setItem('animeData', JSON.stringify(this._data));
        return Promise.resolve({ isOk: true });
    }
};

// ---------------------------------------------------------------------
// â¬‡ï¸ **è«‹ç¢ºä¿å°‡ä½ åŸæœ¬æ‰€æœ‰å…¶ä»–çš„æ‡‰ç”¨ç¨‹å¼é‚è¼¯ (initApp, renderApp ç­‰ç­‰)** â¬‡ï¸
// â¬‡ï¸ **è²¼åœ¨æ­¤è¡Œä¸‹æ–¹ï¼Œä¸¦ç§»é™¤æ‰€æœ‰é‡è¤‡çš„å…¨åŸŸè®Šæ•¸å®£å‘Š** â¬‡ï¸
// ---------------------------------------------------------------------
   // ğŸ’¡ æ–°å¢é€™å€‹å‡½æ•¸ï¼šè¼‰å…¥è³‡æ–™ä¸¦æ›´æ–°ç•«é¢
    async function loadAndRenderData() {
        // 1. å¾æœ¬åœ° SDK å–å¾—æ‰€æœ‰è³‡æ–™
        const result = await window.dataSdk.getAll();
        
        // 2. æ›´æ–°å…¨åŸŸè®Šæ•¸ allAnimeData
        allAnimeData = result;

        // 3. é‡æ–°æ¸²æŸ“æ•´å€‹æ‡‰ç”¨ç¨‹å¼ä»‹é¢
        renderApp(); 
    }

    // ========== å…¨åŸŸè®Šæ•¸ ==========
    let allAnimeData = [];
    let isAdminMode = false;
    let isAdminAuthenticated = false;
    let currentFilters = {
        genre: 'all',
        year: 'all',
        rating: 'all',
        recommendation: 'all'
    };
    let searchQuery = '';
    const ADMIN_PASSWORD = 'admin123';
    
    // å„²å­˜åœ¨ localStorage çš„é¸é …
    let optionsData = {
        genres: ['æˆ€æ„›', 'æ ¡åœ’', 'é‹å‹•', 'å†’éšª', 'å¥‡å¹»', 'ç§‘å¹»', 'æ©Ÿæˆ°', 'æ¨ç†', 'æ‡¸ç–‘', 'é©šæ‚š', 'æ²»ç™’', 'æ—¥å¸¸', 'å–œåŠ‡', 'ç†±è¡€', 'ç•°ä¸–ç•Œ', 'è½‰ç”Ÿ', 'é­”æ³•', 'æˆ°é¬¥'],
        years: ['2030', '2029', '2028', '2027', '2026', '2025', '2024', '2023', '2022', '2021', '2020', '2019', '2018', '2017', '2016', '2015', '2014', '2013', '2012', '2011', '2010', '2009', '2008'],
        months: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12'],
        seasons: ['æ˜¥å­£', 'å¤å­£', 'ç§‹å­£', 'å†¬å­£'],
        episodes: ['12', '13', '24', '25', '26', '52'],
        ratings: ['ç¥', 'è¿·', 'å„ª', 'æ™®', 'åŠ£'],
        recommendations: ['â˜…â˜…â˜…â˜…â˜…', 'â˜…â˜…â˜…â˜…', 'â˜…â˜…â˜…', 'â˜…â˜…', 'â˜…']
    };

    // è¼‰å…¥é¸é …è³‡æ–™
    function loadOptions() {
        const saved = localStorage.getItem('animeOptions');
        if (saved) {
            try {
                optionsData = JSON.parse(saved);
            } catch (e) {
                console.error('è¼‰å…¥é¸é …å¤±æ•—', e);
            }
        }
    }

    // å„²å­˜é¸é …è³‡æ–™
    function saveOptions() {
        localStorage.setItem('animeOptions', JSON.stringify(optionsData));
    }

    loadOptions();

    // ========== SDK åˆå§‹åŒ– ==========
    async function initApp() {
        if (!window.dataSdk) {
            showToast('error', 'è³‡æ–™ç³»çµ±æœªè¼‰å…¥ï¼Œè«‹é‡æ–°æ•´ç†é é¢');
            return;
        }

        // ç§»é™¤äº†åŸæœ¬çš„ dataHandler ç‰©ä»¶ï¼Œå› ç‚ºæœ¬åœ°å„²å­˜ä¸éœ€è¦å³æ™‚ç›£è½
        // const dataHandler = { ... };

        // å‘¼å« init() æ™‚ï¼Œä¸å†å‚³é dataHandler åƒæ•¸
        const result = await window.dataSdk.init();
        
        if (!result.isOk) {
            showToast('error', 'ç³»çµ±åˆå§‹åŒ–å¤±æ•—');
            document.getElementById('app').innerHTML = `
                <div style="text-align: center; padding: 100px 20px; color: white;">
                    <div style="font-size: 48px; margin-bottom: 20px;">âŒ</div>
                    <div style="font-size: 20px; font-weight: 600;">ç³»çµ±åˆå§‹åŒ–å¤±æ•—</div>
                    <div style="font-size: 14px; margin-top: 10px; opacity: 0.8;">è«‹é‡æ–°æ•´ç†é é¢é‡è©¦</div>
                </div>
            `;
            return;
        }

        // æ›¿æ›åŸæœ¬çš„ renderApp(); 
        // æ”¹ç‚ºå‘¼å« loadAndRenderData() ä¾†å¾æœ¬åœ°å„²å­˜è¼‰å…¥è³‡æ–™ä¸¦æ›´æ–°ç•«é¢
        await loadAndRenderData();
    }

    // ========== ä¸»æ¸²æŸ“å‡½æ•¸ ==========
    function renderApp() {
        const app = document.getElementById('app');

        if (isAdminMode && !isAdminAuthenticated) {
            app.innerHTML = renderLoginScreen();
            return;
        }

        if (isAdminMode) {
            app.innerHTML = renderAdminPanel();
            initAdminTabs();
            renderAnimeTable();
        } else {
            app.innerHTML = renderFrontend();
            renderAnimeGrid();
        }
    }

    // ========== ç™»å…¥ç•«é¢ ==========
    function renderLoginScreen() {
        return `
            <div class="login-screen">
                <div class="login-box">
                    <h2>ğŸ” ç®¡ç†å“¡ç™»å…¥</h2>
                    <form onsubmit="handleLogin(event)">
                        <input 
                            type="password" 
                            id="passwordInput" 
                            placeholder="è«‹è¼¸å…¥ç®¡ç†å“¡å¯†ç¢¼"
                            required
                            autocomplete="current-password"
                        >
                        <button type="submit" class="btn btn-primary" style="width: 100%;">
                            ç™»å…¥å¾Œå°
                        </button>
                    </form>
                    <button 
                        class="btn btn-secondary mt-20" 
                        style="width: 100%;"
                        onclick="exitAdminMode()"
                    >
                        è¿”å›å‰å°
                    </button>
                </div>
            </div>
        `;
    }

    function handleLogin(e) {
        e.preventDefault();
        const password = document.getElementById('passwordInput').value;
        
        if (password === ADMIN_PASSWORD) {
            isAdminAuthenticated = true;
            showToast('success', 'ç™»å…¥æˆåŠŸï¼');
            renderApp();
        } else {
            showToast('error', 'å¯†ç¢¼éŒ¯èª¤');
            document.getElementById('passwordInput').value = '';
        }
    }

    // ========== å‰å°æ¸²æŸ“ ==========
    function renderFrontend() {
        const uniqueYears = [...new Set(allAnimeData.map(a => a.year).filter(Boolean))].sort((a, b) => b.localeCompare(a));
        
        return `
            <div class="header">
                <h1>ğŸ¬ å‹•ç•«è³‡æ–™åº«</h1>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="enterAdminMode()">
                        âš™ï¸ ç®¡ç†å¾Œå°
                    </button>
                </div>
            </div>

            <div class="controls">
                <div class="search-bar">
                    <input 
                        type="text" 
                        placeholder="ğŸ” æœå°‹å‹•ç•«åç¨±..." 
                        oninput="handleSearch(this.value)"
                        value="${searchQuery}"
                    >
                </div>
                <div class="filter-selects">
                    <select onchange="handleFilterChange('genre', this.value)">
                        <option value="all">å…¨éƒ¨é¡å‹</option>
                        ${optionsData.genres.map(g => `
                            <option value="${g}" ${currentFilters.genre === g ? 'selected' : ''}>${g}</option>
                        `).join('')}
                    </select>
                    
                    <select onchange="handleFilterChange('year', this.value)">
                        <option value="all">å…¨éƒ¨å¹´åº¦</option>
                        ${uniqueYears.map(y => `
                            <option value="${y}" ${currentFilters.year === y ? 'selected' : ''}>${y}</option>
                        `).join('')}
                    </select>
                    
                    <select onchange="handleFilterChange('rating', this.value)">
                        <option value="all">å…¨éƒ¨è©•åˆ†</option>
                        ${optionsData.ratings.map(r => `
                            <option value="${r}" ${currentFilters.rating === r ? 'selected' : ''}>${r}</option>
                        `).join('')}
                    </select>
                    
                    <select onchange="handleFilterChange('recommendation', this.value)">
                        <option value="all">å…¨éƒ¨æ¨è–¦æŒ‡æ•¸</option>
                        ${optionsData.recommendations.map(r => `
                            <option value="${r}" ${currentFilters.recommendation === r ? 'selected' : ''}>${r}</option>
                        `).join('')}
                    </select>
                </div>
                <button class="btn btn-secondary" onclick="clearAllFilters()" style="width: 100%;">
                    ğŸ”„ æ¸…é™¤æ‰€æœ‰ç¯©é¸
                </button>
            </div>

            <div class="anime-grid" id="animeGrid"></div>
        `;
    }

    function handleFilterChange(filterType, value) {
        currentFilters[filterType] = value;
        renderAnimeGrid();
    }

    function clearAllFilters() {
        currentFilters = {
            genre: 'all',
            year: 'all',
            rating: 'all',
            recommendation: 'all'
        };
        searchQuery = '';
        renderApp();
    }

    function handleSearch(value) {
        searchQuery = value;
        renderAnimeGrid();
    }

    function renderAnimeGrid() {
        const grid = document.getElementById('animeGrid');
        if (!grid) return;

        let filtered = allAnimeData;

        // å¥—ç”¨ç¯©é¸
        if (currentFilters.genre !== 'all') {
            filtered = filtered.filter(anime => anime.genre === currentFilters.genre);
        }
        if (currentFilters.year !== 'all') {
            filtered = filtered.filter(anime => anime.year === currentFilters.year);
        }
        if (currentFilters.rating !== 'all') {
            filtered = filtered.filter(anime => anime.rating === currentFilters.rating);
        }
        if (currentFilters.recommendation !== 'all') {
            filtered = filtered.filter(anime => anime.recommendation === currentFilters.recommendation);
        }

        // æœå°‹
        if (searchQuery.trim()) {
            const query = searchQuery.toLowerCase();
            filtered = filtered.filter(anime => 
                anime.name?.toLowerCase().includes(query)
            );
        }

        if (filtered.length === 0) {
            grid.innerHTML = `
                <div class="empty-state" style="grid-column: 1 / -1;">
                    <div class="empty-state-icon">ğŸ“­</div>
                    <div class="empty-state-text">æ‰¾ä¸åˆ°ç›¸é—œå‹•ç•«</div>
                    <div class="empty-state-hint">è©¦è©¦å…¶ä»–ç¯©é¸æ¢ä»¶æˆ–é¡å‹</div>
                </div>
            `;
            return;
        }

        grid.innerHTML = filtered.map(anime => {
            const posterContent = anime.posterUrl ? 
                `<img src="${anime.posterUrl}" alt="${anime.name || 'ç„¡æ¨™é¡Œ'}" loading="lazy" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                 <div class="no-poster" style="display:none;">ç„¡åœ–ç‰‡</div>` :
                `<div class="no-poster">ç„¡åœ–ç‰‡</div>`;
            
            return `
                <div class="anime-card" onclick="openAnimeDetail('${anime.__backendId}')">
                    ${anime.recommendation ? `<div class="recommendation-badge">${anime.recommendation}</div>` : ''}
                    <div class="anime-card-poster">
                        ${posterContent}
                    </div>
                    <div class="anime-card-content">
                        <div class="anime-card-title">${anime.name || 'ç„¡æ¨™é¡Œ'}</div>
                        <div class="anime-card-meta">
                            ${anime.year || anime.month || anime.season ? `
                                <div class="meta-row">
                                    ${anime.year ? `<span class="meta-badge badge-year">ğŸ“… ${anime.year}</span>` : ''}
                                    ${anime.month ? `<span class="meta-badge badge-year">ğŸ“† ${anime.month}æœˆ</span>` : ''}
                                    ${anime.season ? `<span class="meta-badge badge-year">ğŸŒ¸ ${anime.season}</span>` : ''}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
        }).join('');
    }

    // ========== è©³æƒ…å½ˆçª— ==========
    function openAnimeDetail(backendId) {
        const anime = allAnimeData.find(a => a.__backendId === backendId);
        if (!anime) return;

        const detailContent = document.getElementById('detailContent');
        
        const links = [];
        for (let i = 1; i <= 10; i++) {
            if (anime[`linkName${i}`] && anime[`link${i}`]) {
                links.push({
                    name: anime[`linkName${i}`],
                    url: anime[`link${i}`]
                });
            }
        }

        const posterContent = anime.posterUrl ? 
            `<img src="${anime.posterUrl}" alt="${anime.name || 'ç„¡æ¨™é¡Œ'}" loading="lazy" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
             <div class="no-poster" style="display:none; width:220px; height:300px;">ç„¡åœ–ç‰‡</div>` :
            `<div class="no-poster" style="width:220px; height:300px;">ç„¡åœ–ç‰‡</div>`;

        detailContent.innerHTML = `
            <div class="detail-header">
                <div class="detail-poster">
                    ${posterContent}
                </div>
                <div class="detail-info">
                    <h2 class="detail-title">${anime.name || 'ç„¡æ¨™é¡Œ'}</h2>
                    
                    ${anime.recommendation ? `
                        <div class="detail-meta-row" style="margin-bottom: 15px;">
                            <span class="detail-meta-item meta-recommendation">
                                ğŸ’– æ¨è–¦æŒ‡æ•¸ ${anime.recommendation}
                            </span>
                        </div>
                    ` : ''}
                    
                    <div class="detail-meta-row">
                        ${anime.year ? `<span class="detail-meta-item meta-gold">ğŸ“… ${anime.year}</span>` : ''}
                        ${anime.month ? `<span class="detail-meta-item meta-gold">ğŸ“† ${anime.month}æœˆ</span>` : ''}
                        ${anime.season ? `<span class="detail-meta-item meta-gold">ğŸŒ¸ ${anime.season}</span>` : ''}
                        ${anime.episodes ? `<span class="detail-meta-item meta-gold">ğŸ“º ${anime.episodes} é›†</span>` : ''}
                        ${anime.rating ? `<span class="detail-meta-item meta-gold">â­ è©•åˆ† ${anime.rating}</span>` : ''}
                    </div>
                    
                    <div class="detail-meta-row">
                        ${anime.genre ? `<span class="detail-meta-item meta-cyan ${anime.genre.length > 20 ? 'long-text' : ''}" ${anime.genre.length > 20 ? `title="${anime.genre}"` : ''}>ğŸ¯ ${anime.genre}</span>` : ''}
                    </div>
                    
                    ${anime.description ? `
                        <div style="margin-top: 18px;">
                            <h3 style="font-size: 16px; color: var(--text); margin-bottom: 10px;">ğŸ“– åŠ‡æƒ…ä»‹ç´¹</h3>
                            <div style="max-height: 120px; overflow-y: auto; line-height: 1.6; color: var(--text-dim); font-size: 14px;" class="custom-scroll">${anime.description}</div>
                        </div>
                    ` : ''}
                </div>
            </div>

            ${links.length > 0 ? `
                <div class="detail-links">
                    <h3>ğŸ”— è§€çœ‹é€£çµ</h3>
                    <div class="links-container custom-scroll">
                        <div class="links-grid">
                            ${links.map(link => `
                                <a href="${link.url}" target="_blank" rel="noopener noreferrer" class="link-item">
                                    ğŸ¬ ${link.name}
                                </a>
                            `).join('')}
                        </div>
                    </div>
                </div>
            ` : ''}
        `;

        document.getElementById('detailModal').classList.add('active');
    }

    function closeAnimeDetail() {
        document.getElementById('detailModal').classList.remove('active');
    }

    // ========== å¾Œå°æ¸²æŸ“ ==========
    function renderAdminPanel() {
        return `
            <div class="header">
                <h1>âš™ï¸ ç®¡ç†å¾Œå°</h1>
                <div class="header-actions">
                    <button class="btn btn-secondary" onclick="exitAdminMode()">
                        ğŸ  è¿”å›å‰å°
                    </button>
                    <button class="btn btn-success" onclick="logout()">
                        ğŸšª ç™»å‡º
                    </button>
                </div>
            </div>

            <div class="admin-panel">
                <div class="admin-tabs">
                    <button class="admin-tab active" data-tab="add">â• æ–°å¢å‹•ç•«</button>
                    <button class="admin-tab" data-tab="manage">ğŸ“‹ ç®¡ç†å‹•ç•«</button>
                    <button class="admin-tab" data-tab="options">ğŸ·ï¸ é¸é …ç®¡ç†</button>
                    <button class="admin-tab" data-tab="backup">ğŸ’¾ è³‡æ–™å‚™ä»½</button>
                </div>

                <!-- æ–°å¢å‹•ç•« -->
                <div class="tab-content active" id="tab-add">
                    <form onsubmit="handleAddAnime(event)">
                        <div class="form-group">
                            <label for="animeName">å‹•ç•«åç¨± *</label>
                            <input type="text" id="animeName" required>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="animeYear">å¹´åº¦</label>
                                <select id="animeYear">
                                    <option value="">è«‹é¸æ“‡å¹´åº¦</option>
                                    ${optionsData.years.map(y => `<option value="${y}">${y}</option>`).join('')}
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="animeMonth">æœˆä»½</label>
                                <select id="animeMonth">
                                    <option value="">è«‹é¸æ“‡æœˆä»½</option>
                                    ${optionsData.months.map(m => `<option value="${m}">${m}æœˆ</option>`).join('')}
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="animeSeason">å­£åº¦</label>
                                <select id="animeSeason">
                                    <option value="">è«‹é¸æ“‡å­£åº¦</option>
                                    ${optionsData.seasons.map(s => `<option value="${s}">${s}</option>`).join('')}
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="animeGenre">é¡å‹</label>
                                <select id="animeGenre">
                                    <option value="">è«‹é¸æ“‡é¡å‹</option>
                                    ${optionsData.genres.map(cat => `<option value="${cat}">${cat}</option>`).join('')}
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="animeEpisodes">ç¸½é›†æ•¸</label>
                                <select id="animeEpisodes">
                                    <option value="">è«‹é¸æ“‡é›†æ•¸</option>
                                    ${optionsData.episodes.map(e => `<option value="${e}">${e}é›†</option>`).join('')}
                                    <option value="custom">è‡ªè¨‚...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="animeRating">è©•åˆ†</label>
                                <select id="animeRating">
                                    <option value="">è«‹é¸æ“‡è©•åˆ†</option>
                                    ${optionsData.ratings.map(r => `<option value="${r}">${r}</option>`).join('')}
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="animeRecommendation">æ¨è–¦æŒ‡æ•¸</label>
                                <select id="animeRecommendation">
                                    <option value="">è«‹é¸æ“‡æ¨è–¦æŒ‡æ•¸</option>
                                    ${optionsData.recommendations.map(r => `<option value="${r}">${r}</option>`).join('')}
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="animePoster">æµ·å ±ç¶²å€</label>
                            <input type="url" id="animePoster" placeholder="https://...">
                        </div>

                        <div class="form-group">
                            <label for="animeDescription">åŠ‡æƒ…ä»‹ç´¹</label>
                            <textarea id="animeDescription" rows="4"></textarea>
                        </div>

                        <h3 style="margin: 25px 0 15px; color: var(--primary);">ğŸ”— è§€çœ‹é€£çµï¼ˆæœ€å¤š10å€‹ï¼‰</h3>
                        ${Array.from({length: 10}, (_, i) => i + 1).map(num => `
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="linkName${num}">é€£çµåç¨± ${num}</label>
                                    <input type="text" id="linkName${num}" placeholder="ä¾‹å¦‚ï¼šç¬¬1é›†">
                                </div>
                                <div class="form-group">
                                    <label for="link${num}">é€£çµç¶²å€ ${num}</label>
                                    <input type="url" id="link${num}" placeholder="https://...">
                                </div>
                            </div>
                        `).join('')}

                        <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px;" id="addAnimeBtn">
                            â• æ–°å¢å‹•ç•«
                        </button>
                    </form>
                </div>

                <!-- ç®¡ç†å‹•ç•« -->
                <div class="tab-content" id="tab-manage">
                    <div style="margin-bottom: 15px; color: var(--text-dim);">
                        å…± <strong>${allAnimeData.length}</strong> ç­†å‹•ç•«è³‡æ–™ ${allAnimeData.length >= 999 ? '<span style="color: var(--danger);">(å·²é”ä¸Šé™)</span>' : `(å‰©é¤˜ ${999 - allAnimeData.length} ç­†ç©ºé–“)`}
                    </div>
                    <div class="table-container">
                        <table class="data-table" id="animeTable">
                            <thead>
                                <tr>
                                    <th style="width: 60px;">æµ·å ±</th>
                                    <th>å‹•ç•«åç¨±</th>
                                    <th style="width: 80px;">é¡å‹</th>
                                    <th style="width: 80px;">è©•åˆ†</th>
                                    <th style="width: 100px;">å¹´æœˆ</th>
                                    <th style="width: 150px;">æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="animeTableBody"></tbody>
                        </table>
                    </div>
                </div>

                <!-- é¸é …ç®¡ç† -->
                <div class="tab-content" id="tab-options">
                    ${renderOptionsManagement()}
                </div>

                <!-- è³‡æ–™å‚™ä»½ -->
                <div class="tab-content" id="tab-backup">
                    <div style="display: grid; gap: 20px;">
                        <div style="padding: 20px; background: rgba(0, 188, 212, 0.1); border: 2px solid var(--primary); border-radius: 12px;">
                            <h3 style="color: var(--primary); margin-bottom: 10px;">ğŸ“¥ åŒ¯å…¥è³‡æ–™</h3>
                            <p style="color: var(--text-dim); font-size: 14px; margin-bottom: 15px;">
                                æ”¯æ´ CSVã€Excel æ ¼å¼ï¼ˆ.csv, .xls, .xlsxï¼‰<br>
                                <strong>æœ€ä½è¦æ±‚ï¼š</strong>åªéœ€ã€Œå‹•ç•«åç¨±ã€æ¬„ä½ï¼Œå…¶ä»–æ¬„ä½é¸å¡«
                            </p>
                            <input type="file" id="importFileInput" accept=".csv,.xls,.xlsx" style="margin-bottom: 15px;">
                            <button class="btn btn-primary" onclick="handleImportFile()">
                                ğŸ“¥ é–‹å§‹åŒ¯å…¥
                            </button>
                            <div id="importStatus" style="margin-top: 15px; display: none;"></div>
                        </div>

                        <div style="padding: 20px; background: rgba(40, 167, 69, 0.1); border: 2px solid var(--success); border-radius: 12px;">
                            <h3 style="color: var(--success); margin-bottom: 10px;">ğŸ“¤ åŒ¯å‡ºè³‡æ–™</h3>
                            <p style="color: var(--text-dim); font-size: 14px; margin-bottom: 15px;">
                                å°‡æ‰€æœ‰è³‡æ–™åŒ¯å‡ºç‚º Excel æ ¼å¼
                            </p>
                            <button class="btn btn-success" onclick="exportToExcel()">
                                ğŸ“Š åŒ¯å‡º Excel
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    function renderOptionsManagement() {
        return `
            <div class="options-section">
                <h3>ğŸ·ï¸ é¡å‹é¸é …</h3>
                <div class="options-list">
                    ${optionsData.genres.map(g => `
                        <div class="option-tag">
                            ${g}
                            <span class="option-tag-remove" onclick="removeOption('genres', '${g}')">Ã—</span>
                        </div>
                    `).join('')}
                </div>
                <div class="add-option-form">
                    <input type="text" id="newGenre" placeholder="æ–°å¢é¡å‹...">
                    <button class="btn btn-primary btn-small" onclick="addOption('genres', 'newGenre')">æ–°å¢</button>
                </div>
            </div>

            <div class="options-section">
                <h3>ğŸ“… å¹´åº¦é¸é …</h3>
                <div class="options-list">
                    ${optionsData.years.map(y => `
                        <div class="option-tag">
                            ${y}
                            <span class="option-tag-remove" onclick="removeOption('years', '${y}')">Ã—</span>
                        </div>
                    `).join('')}
                </div>
                <div class="add-option-form">
                    <input type="text" id="newYear" placeholder="æ–°å¢å¹´åº¦...">
                    <button class="btn btn-primary btn-small" onclick="addOption('years', 'newYear')">æ–°å¢</button>
                </div>
            </div>

            <div class="options-section">
                <h3>ğŸ“† æœˆä»½é¸é …</h3>
                <div class="options-list">
                    ${optionsData.months.map(m => `
                        <div class="option-tag">
                            ${m}æœˆ
                            <span class="option-tag-remove" onclick="removeOption('months', '${m}')">Ã—</span>
                        </div>
                    `).join('')}
                </div>
                <div class="add-option-form">
                    <input type="text" id="newMonth" placeholder="æ–°å¢æœˆä»½...">
                    <button class="btn btn-primary btn-small" onclick="addOption('months', 'newMonth')">æ–°å¢</button>
                </div>
            </div>

            <div class="options-section">
                <h3>ğŸŒ¸ å­£åº¦é¸é …</h3>
                <div class="options-list">
                    ${optionsData.seasons.map(s => `
                        <div class="option-tag">
                            ${s}
                            <span class="option-tag-remove" onclick="removeOption('seasons', '${s}')">Ã—</span>
                        </div>
                    `).join('')}
                </div>
                <div class="add-option-form">
                    <input type="text" id="newSeason" placeholder="æ–°å¢å­£åº¦...">
                    <button class="btn btn-primary btn-small" onclick="addOption('seasons', 'newSeason')">æ–°å¢</button>
                </div>
            </div>

            <div class="options-section">
                <h3>ğŸ“º é›†æ•¸é¸é …</h3>
                <div class="options-list">
                    ${optionsData.episodes.map(e => `
                        <div class="option-tag">
                            ${e}é›†
                            <span class="option-tag-remove" onclick="removeOption('episodes', '${e}')">Ã—</span>
                        </div>
                    `).join('')}
                </div>
                <div class="add-option-form">
                    <input type="text" id="newEpisode" placeholder="æ–°å¢é›†æ•¸...">
                    <button class="btn btn-primary btn-small" onclick="addOption('episodes', 'newEpisode')">æ–°å¢</button>
                </div>
            </div>

            <div class="options-section">
                <h3>â­ è©•åˆ†é¸é …</h3>
                <div class="options-list">
                    ${optionsData.ratings.map(r => `
                        <div class="option-tag">
                            ${r}
                            <span class="option-tag-remove" onclick="removeOption('ratings', '${r}')">Ã—</span>
                        </div>
                    `).join('')}
                </div>
                <div class="add-option-form">
                    <input type="text" id="newRating" placeholder="æ–°å¢è©•åˆ†...">
                    <button class="btn btn-primary btn-small" onclick="addOption('ratings', 'newRating')">æ–°å¢</button>
                </div>
            </div>

            <div class="options-section">
                <h3>ğŸ’– æ¨è–¦æŒ‡æ•¸é¸é …</h3>
                <div class="options-list">
                    ${optionsData.recommendations.map(r => `
                        <div class="option-tag">
                            ${r}
                            <span class="option-tag-remove" onclick="removeOption('recommendations', '${r}')">Ã—</span>
                        </div>
                    `).join('')}
                </div>
                <div class="add-option-form">
                    <input type="text" id="newRecommendation" placeholder="æ–°å¢æ¨è–¦æŒ‡æ•¸...">
                    <button class="btn btn-primary btn-small" onclick="addOption('recommendations', 'newRecommendation')">æ–°å¢</button>
                </div>
            </div>
        `;
    }

    function addOption(category, inputId) {
        const input = document.getElementById(inputId);
        const value = input.value.trim();
        
        if (!value) {
            showToast('error', 'è«‹è¼¸å…¥é¸é …å…§å®¹');
            return;
        }

        if (optionsData[category].includes(value)) {
            showToast('error', 'è©²é¸é …å·²å­˜åœ¨');
            return;
        }

        optionsData[category].push(value);
        if (category === 'years') {
            optionsData[category].sort((a, b) => parseFloat(b) - parseFloat(a));
        } else {
            optionsData[category].sort();
        }
        
        saveOptions();
        input.value = '';
        showToast('success', 'é¸é …æ–°å¢æˆåŠŸ');
        
        // é‡æ–°æ¸²æŸ“å¾Œå°
        if (isAdminMode) {
            document.querySelector('[data-tab="options"]').click();
        }
    }

    function removeOption(category, value) {
        const index = optionsData[category].indexOf(value);
        if (index > -1) {
            optionsData[category].splice(index, 1);
            saveOptions();
            showToast('success', 'é¸é …å·²åˆªé™¤');
            
            // é‡æ–°æ¸²æŸ“å¾Œå°
            if (isAdminMode) {
                document.querySelector('[data-tab="options"]').click();
            }
        }
    }

    function initAdminTabs() {
        const tabs = document.querySelectorAll('.admin-tab');
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const targetTab = tab.dataset.tab;
                
                document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                tab.classList.add('active');
                const targetContent = document.getElementById(`tab-${targetTab}`);
                targetContent.classList.add('active');
                
                if (targetTab === 'options') {
                    targetContent.innerHTML = renderOptionsManagement();
                }
            });
        });
    }

    function renderAnimeTable() {
        const tbody = document.getElementById('animeTableBody');
        if (!tbody) return;

        if (allAnimeData.length === 0) {
            tbody.innerHTML = `
                <tr>
                    <td colspan="6" style="text-align: center; padding: 40px; color: var(--text-dim);">
                        å°šç„¡ä»»ä½•å‹•ç•«è³‡æ–™
                    </td>
                </tr>
            `;
            return;
        }

        tbody.innerHTML = allAnimeData.map(anime => {
            const posterContent = anime.posterUrl ? 
                `<img src="${anime.posterUrl}" alt="${anime.name}" loading="lazy" style="width: 50px; height: 70px; object-fit: cover; border-radius: 6px; background: var(--background);" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                 <div class="no-poster" style="display:none; width:50px; height:70px; font-size:10px;">ç„¡åœ–</div>` :
                `<div class="no-poster" style="width:50px; height:70px; font-size:10px;">ç„¡åœ–</div>`;
            
            return `
                <tr>
                    <td>${posterContent}</td>
                    <td style="font-weight: 600;">${anime.name || 'ç„¡æ¨™é¡Œ'}</td>
                    <td>${anime.genre || '-'}</td>
                    <td>${anime.rating || '-'}</td>
                    <td>${anime.year || '-'} / ${anime.month || '-'}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-primary btn-small" onclick="editAnime('${anime.__backendId}')">
                                âœï¸ ç·¨è¼¯
                            </button>
                            <button class="btn btn-secondary btn-small" onclick="confirmDeleteAnime('${anime.__backendId}')">
                                ğŸ—‘ï¸ åˆªé™¤
                            </button>
                        </div>
                    </td>
                </tr>
            `;
        }).join('');
    }

    // ========== CRUD æ“ä½œ ==========
    async function handleAddAnime(e) {
        e.preventDefault();

        if (allAnimeData.length >= 999) {
            showToast('error', 'å·²é”æœ€å¤§é™åˆ¶ 999 ç­†å‹•ç•«');
            return;
        }

        const btn = document.getElementById('addAnimeBtn');
        btn.disabled = true;
        btn.innerHTML = '<span class="loading-spinner"></span> æ–°å¢ä¸­...';

        const animeData = {
            name: document.getElementById('animeName').value.trim(),
            posterUrl: document.getElementById('animePoster').value.trim(),
            rating: document.getElementById('animeRating').value,
            recommendation: document.getElementById('animeRecommendation').value,
            year: document.getElementById('animeYear').value,
            month: document.getElementById('animeMonth').value,
            season: document.getElementById('animeSeason').value,
            genre: document.getElementById('animeGenre').value,
            episodes: document.getElementById('animeEpisodes').value === 'custom' ? 
                window.prompt('è«‹è¼¸å…¥è‡ªè¨‚é›†æ•¸ï¼š') || '' : 
                document.getElementById('animeEpisodes').value,
            description: document.getElementById('animeDescription').value.trim(),
            createdAt: new Date().toISOString()
        };

        for (let i = 1; i <= 10; i++) {
            animeData[`linkName${i}`] = document.getElementById(`linkName${i}`).value.trim();
            animeData[`link${i}`] = document.getElementById(`link${i}`).value.trim();
        }

        const result = await window.dataSdk.create(animeData);

        if (result.isOk) {
            showToast('success', 'å‹•ç•«æ–°å¢æˆåŠŸï¼');
            e.target.reset();
        } else {
            showToast('error', 'æ–°å¢å¤±æ•—ï¼š' + result.error.message);
        }

        btn.disabled = false;
        btn.innerHTML = 'â• æ–°å¢å‹•ç•«';
    }

    function editAnime(backendId) {
        const anime = allAnimeData.find(a => a.__backendId === backendId);
        if (!anime) return;

        document.querySelector('[data-tab="add"]').click();

        document.getElementById('animeName').value = anime.name || '';
        document.getElementById('animePoster').value = anime.posterUrl || '';
        document.getElementById('animeRating').value = anime.rating || '';
        document.getElementById('animeRecommendation').value = anime.recommendation || '';
        document.getElementById('animeYear').value = anime.year || '';
        document.getElementById('animeMonth').value = anime.month || '';
        document.getElementById('animeSeason').value = anime.season || '';
        document.getElementById('animeGenre').value = anime.genre || '';
        document.getElementById('animeEpisodes').value = anime.episodes || '';
        document.getElementById('animeDescription').value = anime.description || '';

        for (let i = 1; i <= 10; i++) {
            document.getElementById(`linkName${i}`).value = anime[`linkName${i}`] || '';
            document.getElementById(`link${i}`).value = anime[`link${i}`] || '';
        }

        const form = document.querySelector('#tab-add form');
        form.onsubmit = (e) => handleUpdateAnime(e, backendId);

        const btn = document.getElementById('addAnimeBtn');
        btn.textContent = 'ğŸ’¾ æ›´æ–°å‹•ç•«';
        btn.className = 'btn btn-success';

        showToast('success', 'å·²è¼‰å…¥å‹•ç•«è³‡æ–™ï¼Œä¿®æ”¹å¾Œé»æ“Šã€Œæ›´æ–°å‹•ç•«ã€');
    }

    async function handleUpdateAnime(e, backendId) {
        e.preventDefault();

        const anime = allAnimeData.find(a => a.__backendId === backendId);
        if (!anime) {
            showToast('error', 'æ‰¾ä¸åˆ°è©²å‹•ç•«è³‡æ–™');
            return;
        }

        const btn = document.getElementById('addAnimeBtn');
        btn.disabled = true;
        btn.innerHTML = '<span class="loading-spinner"></span> æ›´æ–°ä¸­...';

        const updatedData = {
            ...anime,
            name: document.getElementById('animeName').value.trim(),
            posterUrl: document.getElementById('animePoster').value.trim(),
            rating: document.getElementById('animeRating').value,
            recommendation: document.getElementById('animeRecommendation').value,
            year: document.getElementById('animeYear').value,
            month: document.getElementById('animeMonth').value,
            season: document.getElementById('animeSeason').value,
            genre: document.getElementById('animeGenre').value,
            episodes: document.getElementById('animeEpisodes').value === 'custom' ? 
                window.prompt('è«‹è¼¸å…¥è‡ªè¨‚é›†æ•¸ï¼š') || anime.episodes : 
                document.getElementById('animeEpisodes').value,
            description: document.getElementById('animeDescription').value.trim()
        };

        for (let i = 1; i <= 10; i++) {
            updatedData[`linkName${i}`] = document.getElementById(`linkName${i}`).value.trim();
            updatedData[`link${i}`] = document.getElementById(`link${i}`).value.trim();
        }

        const result = await window.dataSdk.update(updatedData);

        if (result.isOk) {
            showToast('success', 'å‹•ç•«æ›´æ–°æˆåŠŸï¼');
            resetForm();
        } else {
            showToast('error', 'æ›´æ–°å¤±æ•—ï¼š' + result.error.message);
        }

        btn.disabled = false;
        btn.innerHTML = 'ğŸ’¾ æ›´æ–°å‹•ç•«';
    }

    function resetForm() {
        const form = document.querySelector('#tab-add form');
        form.reset();
        form.onsubmit = handleAddAnime;
        
        const btn = document.getElementById('addAnimeBtn');
        btn.textContent = 'â• æ–°å¢å‹•ç•«';
        btn.className = 'btn btn-primary';
    }

    function confirmDeleteAnime(backendId) {
        const anime = allAnimeData.find(a => a.__backendId === backendId);
        if (!anime) return;

        const overlay = document.createElement('div');
        overlay.className = 'modal-overlay active';
        overlay.innerHTML = `
            <div class="modal-content" style="max-width: 500px; padding: 30px; text-align: center;">
                <h2 style="color: var(--danger); margin-bottom: 20px;">âš ï¸ ç¢ºèªåˆªé™¤</h2>
                <p style="margin-bottom: 30px; font-size: 16px; color: var(--text);">
                    ç¢ºå®šè¦åˆªé™¤å‹•ç•«<br><strong style="color: var(--primary);">${anime.name}</strong> å—ï¼Ÿ<br>
                    <span style="font-size: 14px; color: var(--text-dim);">æ­¤æ“ä½œç„¡æ³•å¾©åŸ</span>
                </p>
                <div style="display: flex; gap: 12px; justify-content: center;">
                    <button class="btn btn-secondary" onclick="this.closest('.modal-overlay').remove()">
                        å–æ¶ˆ
                    </button>
                    <button class="btn btn-primary" style="background: var(--danger);" onclick="deleteAnime('${backendId}')">
                        ç¢ºå®šåˆªé™¤
                    </button>
                </div>
            </div>
        `;
        document.body.appendChild(overlay);
    }

    async function deleteAnime(backendId) {
        const anime = allAnimeData.find(a => a.__backendId === backendId);
        if (!anime) return;

        document.querySelector('.modal-overlay.active')?.remove();

        const result = await window.dataSdk.delete(anime);

        if (result.isOk) {
            showToast('success', 'å‹•ç•«å·²åˆªé™¤');
            // âœ… æ–°å¢é€™è¡Œï¼šæˆåŠŸå¾Œæ›´æ–°ç•«é¢
            await loadAndRenderData(); 
        } else {
            showToast('error', 'åˆªé™¤å¤±æ•—ï¼š' + result.error.message);
        }
    }


    // ========== åŒ¯å…¥åŒ¯å‡º ==========
    async function exportToExcel() {
        if (allAnimeData.length === 0) {
            showToast('error', 'æ²’æœ‰è³‡æ–™å¯ä»¥åŒ¯å‡º');
            return;
        }

        const btn = event.target;
        const originalHTML = btn.innerHTML;
        btn.disabled = true;
        btn.innerHTML = '<span class="loading-spinner"></span> è™•ç†ä¸­...';

        try {
            const headers = [
                'å‹•ç•«åç¨±', 'å¹´åº¦', 'æœˆä»½', 'å­£åº¦', 'é¡å‹', 'ç¸½é›†æ•¸', 'è©•åˆ†', 'æ¨è–¦æŒ‡æ•¸', 'åŠ‡æƒ…ä»‹ç´¹', 'æµ·å ±ç¶²å€'
            ];
            
            for (let i = 1; i <= 10; i++) {
                headers.push(`é€£çµåç¨±${i}`, `é€£çµ${i}`);
            }

            let excelContent = `
                <html xmlns:x="urn:schemas-microsoft-com:office:excel">
                <head>
                    <meta charset="UTF-8">
                    <xml>
                        <x:ExcelWorkbook>
                            <x:ExcelWorksheets>
                                <x:ExcelWorksheet>
                                    <x:Name>å‹•ç•«è³‡æ–™</x:Name>
                                    <x:WorksheetOptions>
                                        <x:DisplayGridlines/>
                                    </x:WorksheetOptions>
                                </x:ExcelWorksheet>
                            </x:ExcelWorksheets>
                        </x:ExcelWorkbook>
                    </xml>
                    <style>
                        table { border-collapse: collapse; width: 100%; }
                        th, td { 
                            border: 1px solid #ccc; 
                            padding: 8px; 
                            text-align: left; 
                            height: 30px;
                            max-height: 30px;
                            overflow: hidden;
                            vertical-align: top;
                        }
                        th { background-color: #00bcd4; color: white; font-weight: bold; }
                        tr { height: 30px; }
                    </style>
                </head>
                <body>
                    <table>
                        <thead>
                            <tr style="height: 30px;">
                                ${headers.map(h => `<th>${h}</th>`).join('')}
                            </tr>
                        </thead>
                        <tbody>
            `;

            allAnimeData.forEach(anime => {
                excelContent += '<tr style="height: 30px;">';
                excelContent += `<td>${escapeHtml(anime.name || '')}</td>`;
                excelContent += `<td>${escapeHtml(anime.year || '')}</td>`;
                excelContent += `<td>${escapeHtml(anime.month || '')}</td>`;
                excelContent += `<td>${escapeHtml(anime.season || '')}</td>`;
                excelContent += `<td>${escapeHtml(anime.genre || '')}</td>`;
                excelContent += `<td>${escapeHtml(anime.episodes || '')}</td>`;
                excelContent += `<td>${escapeHtml(anime.rating || '')}</td>`;
                excelContent += `<td>${escapeHtml(anime.recommendation || '')}</td>`;
                excelContent += `<td>${escapeHtml(anime.description || '')}</td>`;
                excelContent += `<td>${escapeHtml(anime.posterUrl || '')}</td>`;
                for (let i = 1; i <= 10; i++) {
                    excelContent += `<td>${escapeHtml(anime[`linkName${i}`] || '')}</td>`;
                    excelContent += `<td>${escapeHtml(anime[`link${i}`] || '')}</td>`;
                }
                excelContent += '</tr>';
            });

            excelContent += `
                        </tbody>
                    </table>
                </body>
                </html>
            `;

            const newWindow = window.open('', '_blank');
            if (newWindow) {
                newWindow.document.write(excelContent);
                newWindow.document.close();
                showToast('success', `å·²åœ¨æ–°åˆ†é é–‹å•Ÿï¼å…± ${allAnimeData.length} ç­†ï¼Œè«‹æŒ‰ Ctrl+S å„²å­˜`);
            } else {
                showToast('error', 'ç„¡æ³•é–‹å•Ÿæ–°åˆ†é ï¼Œè«‹æª¢æŸ¥å½ˆå‡ºè¦–çª—å°é–è¨­å®š');
            }
            
            btn.disabled = false;
            btn.innerHTML = originalHTML;
        } catch (error) {
            btn.disabled = false;
            btn.innerHTML = originalHTML;
            showToast('error', 'åŒ¯å‡ºå¤±æ•—ï¼š' + error.message);
        }
    }

    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    async function handleImportFile() {
        const fileInput = document.getElementById('importFileInput');
        const file = fileInput.files[0];

        if (!file) {
            showToast('error', 'è«‹é¸æ“‡è¦åŒ¯å…¥çš„æª”æ¡ˆ');
            return;
        }

        const statusDiv = document.getElementById('importStatus');
        statusDiv.style.display = 'block';
        statusDiv.innerHTML = '<div style="color: var(--text-dim);"><span class="loading-spinner"></span> æ­£åœ¨è™•ç†æª”æ¡ˆ...</div>';

        try {
            await importFromCSV(file);
        } catch (error) {
            showToast('error', 'åŒ¯å…¥å¤±æ•—ï¼š' + error.message);
            statusDiv.innerHTML = `<div style="color: #dc3545;">âŒ åŒ¯å…¥å¤±æ•—ï¼š${error.message}</div>`;
        }
    }

    function parseCSVLine(line) {
        line = line.replace(/^\uFEFF/, '');
        
        if (line.includes('\t')) {
            return line.split('\t').map(cell => cell.trim());
        }
        
        const result = [];
        let current = '';
        let inQuotes = false;

        for (let i = 0; i < line.length; i++) {
            const char = line[i];
            const nextChar = line[i + 1];

            if (char === '"') {
                if (inQuotes && nextChar === '"') {
                    current += '"';
                    i++;
                } else {
                    inQuotes = !inQuotes;
                }
            } else if (char === ',' && !inQuotes) {
                result.push(current.trim());
                current = '';
            } else {
                current += char;
            }
        }
        result.push(current.trim());
        return result;
    }

    async function importFromCSV(file) {
        const reader = new FileReader();
        
        reader.onload = async (e) => {
            try {
                const text = e.target.result;
                const lines = text.split(/\r?\n/).filter(line => line.trim());
                
                if (lines.length < 2) {
                    throw new Error('æª”æ¡ˆæ ¼å¼éŒ¯èª¤ï¼šæª”æ¡ˆè‡³å°‘éœ€è¦ä¸€åˆ—æ¨™é¡Œåˆ—å’Œä¸€ç­†è³‡æ–™');
                }

                const headers = parseCSVLine(lines[0]);
                const mappedData = [];

                for (let i = 1; i < lines.length; i++) {
                    const values = parseCSVLine(lines[i]);
                    
                    if (values.every(v => !v || !v.trim())) {
                        continue;
                    }
                    
                    const row = {};
                    
                    headers.forEach((header, index) => {
                        let value = values[index] || '';
                        value = value.replace(/^"+|"+$/g, '').trim();
                        
                        if (header === 'å‹•ç•«åç¨±') row.name = value;
                        else if (header === 'å¹´åº¦') row.year = value;
                        else if (header === 'æœˆä»½') row.month = value;
                        else if (header === 'å­£åº¦') row.season = value;
                        else if (header === 'é¡å‹') row.genre = value;
                        else if (header === 'ç¸½é›†æ•¸') row.episodes = value;
                        else if (header === 'è©•åˆ†') row.rating = value;
                        else if (header === 'æ¨è–¦æŒ‡æ•¸') row.recommendation = value;
                        else if (header === 'åŠ‡æƒ…ä»‹ç´¹') row.description = value;
                        else if (header === 'æµ·å ±ç¶²å€') row.posterUrl = value;
                        else if (header.match(/é€£çµåç¨±(\d+)/)) {
                            const num = header.match(/\d+/)[0];
                            row[`linkName${num}`] = value;
                        }
                        else if (header.match(/é€£çµ(\d+)/)) {
                            const num = header.match(/\d+/)[0];
                            row[`link${num}`] = value;
                        }
                    });

                    if (row.name) {
                        row.name = row.name.trim();
                    }

                    if (!row.name || row.name.length === 0) {
                        console.warn(`ç¬¬ ${i+1} åˆ—çš„å‹•ç•«åç¨±ç‚ºç©ºï¼Œå·²è·³é`);
                        continue;
                    }

                    if (!row.year) row.year = '';
                    if (!row.month) row.month = '';
                    if (!row.season) row.season = '';
                    if (!row.genre) row.genre = '';
                    if (!row.episodes) row.episodes = '';
                    if (!row.rating) row.rating = '';
                    if (!row.recommendation) row.recommendation = '';
                    if (!row.description) row.description = '';
                    if (!row.posterUrl) row.posterUrl = '';
                    
                    row.createdAt = new Date().toISOString();
                    
                    for (let j = 1; j <= 10; j++) {
                        if (!row[`linkName${j}`]) row[`linkName${j}`] = '';
                        if (!row[`link${j}`]) row[`link${j}`] = '';
                    }
                    
                    mappedData.push(row);
                }

                if (mappedData.length === 0) {
                    throw new Error('æª”æ¡ˆä¸­æ²’æœ‰æœ‰æ•ˆè³‡æ–™ï¼ˆè«‹ç¢ºèªè‡³å°‘æœ‰ä¸€ç­†è³‡æ–™å«æœ‰ã€Œå‹•ç•«åç¨±ã€æ¬„ä½ä¸”ä¸ç‚ºç©ºï¼‰');
                }

                await importAnimeData(mappedData);
            } catch (error) {
                showToast('error', 'æª”æ¡ˆè§£æå¤±æ•—ï¼š' + error.message);
                document.getElementById('importStatus').innerHTML = `<div style="color: #dc3545;">âŒ æª”æ¡ˆè§£æå¤±æ•—ï¼š${error.message}</div>`;
            }
        };

        reader.readAsText(file, 'UTF-8');
    }

    async function importAnimeData(dataArray) {
        const statusDiv = document.getElementById('importStatus');
        let successCount = 0;
        let failCount = 0;
        const errors = [];

        for (let idx = 0; idx < dataArray.length; idx++) {
            const item = dataArray[idx];
            
            if (!item.name || item.name.trim() === '') {
                failCount++;
                errors.push(`ç¬¬ ${idx + 1} ç­†ï¼šç¼ºå°‘å‹•ç•«åç¨±`);
                continue;
            }

            if (allAnimeData.length + successCount >= 999) {
                showToast('error', 'å·²é”åˆ°æœ€å¤§é™åˆ¶ 999 ç­†');
                break;
            }

            const result = await window.dataSdk.create(item);
            if (result.isOk) {
                successCount++;
            } else {
                failCount++;
                errors.push(`ç¬¬ ${idx + 1} ç­†ï¼š${item.name} - å„²å­˜å¤±æ•—`);
            }
        }

        statusDiv.innerHTML = `
            <div style="padding: 15px; background: ${failCount === 0 ? 'rgba(40, 167, 69, 0.1)' : 'rgba(255, 193, 7, 0.1)'}; border: 1px solid ${failCount === 0 ? '#28a745' : '#ffc107'}; border-radius: 8px;">
                <div style="color: ${failCount === 0 ? '#28a745' : '#ffc107'}; font-weight: bold; margin-bottom: 5px;">
                    ${failCount === 0 ? 'âœ… åŒ¯å…¥å®Œæˆ' : 'âš ï¸ åŒ¯å…¥éƒ¨åˆ†å®Œæˆ'}
                </div>
                <div style="font-size: 13px; color: var(--text-dim); margin-bottom: ${errors.length > 0 ? '10px' : '0'};">
                    æˆåŠŸï¼š${successCount} ç­†${failCount > 0 ? ` | å¤±æ•—ï¼š${failCount} ç­†` : ''}
                </div>
                ${errors.length > 0 ? `
                    <div style="font-size: 12px; color: #dc3545; max-height: 150px; overflow-y: auto; border-top: 1px solid var(--border); padding-top: 10px;">
                        <strong>å¤±æ•—åŸå› ï¼š</strong><br>
                        ${errors.slice(0, 5).join('<br>')}
                        ${errors.length > 5 ? `<br>...åŠå…¶ä»– ${errors.length - 5} ç­†` : ''}
                    </div>
                ` : ''}
            </div>
        `;

        if (successCount > 0) {
            showToast('success', `åŒ¯å…¥å®Œæˆï¼æˆåŠŸ ${successCount} ç­†${failCount > 0 ? `ï¼Œå¤±æ•— ${failCount} ç­†` : ''}`);
        } else {
            showToast('error', 'åŒ¯å…¥å¤±æ•—ï¼šæ‰€æœ‰è³‡æ–™éƒ½ç„¡æ³•è™•ç†');
        }
        
        document.getElementById('importFileInput').value = '';
    }

    // ========== æ¨¡å¼åˆ‡æ› ==========
    function enterAdminMode() {
        isAdminMode = true;
        renderApp();
    }

    function exitAdminMode() {
        isAdminMode = false;
        isAdminAuthenticated = false;
        renderApp();
    }

    function logout() {
        isAdminAuthenticated = false;
        renderApp();
        showToast('success', 'å·²ç™»å‡º');
    }

    // ========== Toast é€šçŸ¥ ==========
    function showToast(type, message) {
        const toast = document.getElementById('toast');
        const icon = document.getElementById('toastIcon');
        const msg = document.getElementById('toastMessage');

        toast.className = `toast ${type}`;
        icon.textContent = type === 'success' ? 'âœ…' : 'âŒ';
        msg.textContent = message;

        toast.classList.add('show');

        setTimeout(() => {
            toast.classList.remove('show');
        }, 3000);
    }

    // ========== Modal é»æ“Šå¤–éƒ¨é—œé–‰ ==========
    document.addEventListener('click', (e) => {
        if (e.target.classList.contains('modal-overlay')) {
            e.target.classList.remove('active');
        }
    });

    // ========== åˆå§‹åŒ– ==========
    initApp();

</script>