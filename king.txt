# ğŸ—ï¸ ACG æ”¶è—åº« â€” é–‹ç™¼è—åœ–

## 1ï¸âƒ£ æŠ€è¡“æ¶æ§‹

| çµ„ä»¶ | æŠ€è¡“æ£§ | é¸ç”¨ç†ç”± |
|--------|----------|----------|
| å‰ç«¯æ¸²æŸ“ | åŸç”Ÿ JavaScriptï¼ˆES6+ï¼‰+ CSS Grid/Flexbox | è¼•é‡ã€é›¶ä¾è³´ã€æ˜“æ–¼éƒ¨ç½²éœæ…‹ç«™é» |
| è³‡æ–™åº« | Supabaseï¼ˆPostgreSQLï¼‰ | é›²ç«¯æ‰˜ç®¡ã€å³æ™‚ RLS æ”¿ç­–ã€æ”¯æ´ Auth |
| èªè­‰ | Supabase Authï¼ˆJWTï¼‰ | å…§å»ºæ–¼ Supabaseï¼Œé¿å…è‡ªå»ºæœå‹™ |
| æª”æ¡ˆå„²å­˜ | GitHub Pages | å…è²»ã€ç‰ˆæœ¬ç®¡ç†ã€è‡ªå‹• CI/CD |
| çµ±è¨ˆåˆ†æ | è‡ªå»º `analytics.js`ï¼ˆlocalStorage å¿«å– + Supabase èšåˆï¼‰ | ä½å»¶é²ã€å¯é›¢ç·šå¿«å–ã€ç„¡ç¬¬ä¸‰æ–¹è¿½è¹¤éš±ç§é¢¨éšª |

### è³‡æ–™æµï¼ˆå…¸å‹è«‹æ±‚é€±æœŸï¼‰

```
ç”¨æˆ¶è¼‰å…¥é é¢
  â†“
[initApp] ç­‰å¾… SupabaseManager å°±ç·’ï¼ˆæœ€å¤š 5 ç§’ï¼‰
  â†“
[initApp] å–å¾—ç•¶å‰ Sessionï¼ˆauth.onAuthStateChangeï¼‰
  â†“
[initApp] æª¢æŸ¥ç®¡ç†å“¡èº«åˆ†ï¼ˆcheckIsAdminï¼‰
  â†“
[initApp] è¼‰å…¥ site_settings + anime_list
  â†“
[renderApp] ä¾ç…§ currentCategory éæ¿¾èˆ‡æ¸²æŸ“
  â†“
[switchCategory] è§¸ç™¼ trackCategorySwitchï¼ˆæ›´æ–° category_clicksï¼‰
  â†“
[trackVisit] æ›´æ–° site_visitors + page_viewsï¼ˆé˜²é‡è¤‡ï¼Œ5 åˆ†é˜å…§ä¸é‡è¨ˆï¼‰
  â†“
[loadAnalytics] èšåˆçµ±è¨ˆæ•¸æ“šä¸¦æ›´æ–°é¡¯ç¤º
```

### é‚è¼¯ç´„æŸ

| é …ç›® | ç­–ç•¥ |
|--------|--------|
| éŒ¯èª¤è™•ç† | æ‰€æœ‰ Supabase å‘¼å«çš†æœ‰ `try/catch`ï¼Œå¤±æ•—æ™‚é™ç´šè‡³é›¢ç·šæ¨¡å¼æˆ–å¿«å– |
| å¿«å–ç­–ç•¥ | `analytics_cache` TTL 1 å°æ™‚ï¼ˆä¾è³´ localStorageï¼‰ |
| ç‹€æ…‹ç®¡ç† | å…¨åŸŸè®Šæ•¸ `animeData` / `siteSettings` / `analyticsData` + `isAdmin` |
| ä½ˆå±€è·³å‹•é˜²è­· | æ•¸å€¼ span å›ºå®š `min-width: 60px`ï¼Œé è¨­ `--` ä½”ä½ |
| æœƒè©±æŒä¹…åŒ– | Supabase Auth `persistSession: true` + `autoRefreshToken: true` |

---

## 2ï¸âƒ£ è¨­è¨ˆç›£ç£

### è¨­è¨ˆç³»çµ±ï¼ˆToken é¢¨æ ¼ï¼‰

```yaml
primary-color:
  default: "#00d4ff"
  usage: [æŒ‰éˆ•é‚Šæ¡†, æ¨™é¡Œéœ“è™¹å…‰æšˆ, å¡ç‰‡é‚Šæ¡†, èƒŒæ™¯å…‰æ–‘]

accent-color:
  default: "#b026ff"
  usage: [è©•åˆ†æ¨™ç±¤, å¡ç‰‡é‡é»å€, æ»¾è¼ªé«˜äº®]

text-primary: "#ffffff"
text-secondary: "#666666"

rating-colors:
  ç¥: "#ff4444"
  è¿·: "#ff8800"
  å„ª: "#00d4ff"
  æ™®: "#b026ff"
  åŠ£: "#444444"

spacing:
  gap-base: 15px
  padding-base: 20px
  modal-radius: 16px
  grid-gap: 20px

typography:
  headings: "Orbitron, monospace"
  body: "Noto Sans TC, sans-serif"
  mono: "Space Mono, monospace"
  label-size: 12px
  body-size: 14px
```

### UX é‚è¼¯

1) **ç™»å…¥/ç™»å‡ºæµç¨‹**
   - æœªç™»å…¥ â†’ é¡¯ç¤ºã€Œç®¡ç†å“¡ç™»å…¥ã€æŒ‰éˆ•
   - ç™»å…¥æˆåŠŸ â†’ AuthStateChange è§¸ç™¼ `checkIsAdmin` â†’ æ›´æ–°å³ä¸Šè§’é¸å–®
   - ç™»å‡º â†’ æ¸…é™¤ Sessionï¼Œè‡ªå‹•åˆ‡å›ã€Œç™»å…¥ã€é¸é …

2) **è¡¨å–®å›é¥‹**
   - å„²å­˜æˆåŠŸï¼šToast `âœ“ è¨­å®šå·²æ›´æ–°`ï¼ˆç¶ è‰²ï¼Œ3 ç§’æ·¡å‡ºï¼‰
   - å¤±æ•—ï¼šToast `âœ— æ“ä½œå¤±æ•—ï¼š[éŒ¯èª¤è¨Šæ¯]`ï¼ˆç´…è‰²ï¼‰

3) **å¯è¨ªå•æ€§ï¼ˆA11yï¼‰**
   - å¡ç‰‡ï¼š`cursor: pointer` + `onclick`ï¼ˆéµç›¤ Tab å¯èšç„¦ï¼‰
   - æ¨¡æ…‹æ¡†ï¼š`z-index: 10000` + èƒŒæ™¯é®ç½©
   - æ»¾è¼ªï¼š`force-scroll` class + `onwheel` æ©«å‘æ»¾å‹•æ”¯æ´
   - é¡è‰²å°æ¯”ï¼šè‡³å°‘ 3:1ï¼ˆç™½å­—åœ¨ #0a0e1a èƒŒæ™¯ï¼‰

### è¦–è¦ºè­˜åˆ¥

- **ç¶²æ ¼ç³»çµ±**ï¼š`grid-template-columns: repeat(N, 1fr)`ï¼ŒN ä¾ `gridColumns`ï¼ˆ3/4/5/mobileï¼‰
- **çµ„ä»¶å±¤ç´š**ï¼š
  1. Loading screenï¼ˆ`z-index: 999999`ï¼‰
  2. Modalï¼ˆ`z-index: 10000`ï¼‰
  3. System menuï¼ˆ`z-index: 999`ï¼‰
  4. Toastï¼ˆ`z-index: 10001`ï¼‰
- **è³‡æºäº¤ä»˜**ï¼šå­—é«” Google Fontsã€åœ–ç‰‡ `object-fit: cover`ã€lazy loadingï¼ˆé ç•™ä½”ä½ï¼‰

---

## 3ï¸âƒ£ äº¤ä»˜ç­–ç•¥

### é‡Œç¨‹ç¢‘ï¼ˆWeek 1 â†’ Launchï¼‰

| é€±æ¬¡ | é‡Œç¨‹ç¢‘ | äº¤ä»˜ç‰© |
|--------|----------|----------|
| Week 1 | åŸºç¤æ¶æ§‹é©—è­‰ | Supabase é€£ç·šæ¸¬è©¦ã€RLS æ”¿ç­–å¯©æŸ¥ã€æœ¬åœ°ç’°å¢ƒå•Ÿå‹• |
| Week 2 | å‰å° UI å®Œæˆ | å¡ç‰‡æ¸²æŸ“ã€åˆ†é ã€ç¯©é¸ã€æœå°‹ã€éŸ¿æ‡‰å¼æ–·é»ï¼ˆ768pxï¼‰ |
| Week 3 | å¾Œå°ç®¡ç†å¯¦ä½œ | ç™»å…¥/ç™»å‡ºã€ä½œå“ CRUDã€å…¬å‘Šå¢åˆªã€è¨­å®šä¿å­˜ |
| Week 4 | çµ±è¨ˆèˆ‡å„ªåŒ– | è¨ªå®¢è¿½è¹¤ã€é»æ“Šçµ±è¨ˆã€localStorage å¿«å–ã€Lighthouse å„ªåŒ– |
| Week 5 | æ¸¬è©¦èˆ‡ä¿®å¾© | E2E æ¸¬è©¦ã€RLS æ¸¬è©¦ã€éŒ¯èª¤é‚Šç•Œæ¡ˆä¾‹ã€å®‰å…¨å¯©è¨ˆ |
| Week 6 | éƒ¨ç½²ä¸Šç·š | GitHub Pages è¨­å®šã€è‡ªè¨‚åŸŸåã€CI/CD é©—è­‰ã€æ­£å¼ç’°å¢ƒç›£æ§ |

### é¢¨éšªçŸ©é™£

| é¢¨éšª | å½±éŸ¿ | ç·©è§£ç­–ç•¥ |
|--------|--------|----------|
| Supabase RLS èª¤é…ç½® | è³‡æ–™è®€å–å¤±æ•—ï¼ˆ403ï¼‰ | åŸ·è¡Œ `fix_rls_secure.sql`ï¼Œé€è¡¨é©—è­‰ SELECT/INSERT/UPDATE æ¬Šé™ |
| Auth Session éæœŸ | éç®¡ç†å“¡èª¤åˆ¤ç‚ºç”¨æˆ¶ | å¯¦ä½œ `autoRefreshToken: true` + `onAuthStateChange` å³æ™‚åµæ¸¬ |
| LocalStorage å¿«å–æ±™æŸ“ | çµ±è¨ˆæ•¸å€¼ä¸æº–ç¢º | å¢åŠ  TTL 1 å°æ™‚ + æ¸…é™¤ç­–ç•¥ + é¦–æ¬¡è¼‰å…¥å¾ Supabase å¼·åˆ¶åˆ·æ–° |
| éŸ¿æ‡‰å¼ä½ˆå±€è·³å‹• | æ‰‹æ©Ÿç‰ˆå¡ç‰‡é«˜åº¦ä¸ä¸€è‡´ | æ‰€æœ‰æ•¸å€¼ span å›ºå®š `min-width: 60px` + `display: inline-block` |
| è·¨ç€è¦½å™¨ç›¸å®¹æ€§ | Safari/èˆŠç‰ˆ IE æ¸²æŸ“ç•°å¸¸ | é™ç´š Polyfillï¼ˆ`performance.getEntriesByType` é˜²è­·ï¼‰ |
| CDN è³‡æºè¼‰å…¥å¤±æ•— | Supabase SDK ç„¡æ³•åˆå§‹åŒ– | é›¢ç·šæ¨¡å¼é™ç´š + Toast æç¤º + `retryDelay` æŒ‡æ•¸é€€é¿ |

---

## âœ… Definition of Doneï¼ˆå®Œæˆå®šç¾©ï¼‰

### æŠ€è¡“æº–å‰‡
- [ ] Supabase é€£ç·šæˆåŠŸç‡ â‰¥ 99.9%ï¼ˆåŒ…å« RLS æ¸¬è©¦ï¼‰
- [ ] æ‰€æœ‰ Supabase å‘¼å«çš†æœ‰éŒ¯èª¤è™•ç† + ç”¨æˆ¶æç¤º
- [ ] Auth ç‹€æ…‹åˆ‡æ›åœ¨ä¸‰ç§’å…§å®Œæˆï¼ˆToast é¡¯ç¤ºï¼‰
- [ ] çµ±è¨ˆæ¨¡çµ„æ”¯æ´é›¢ç·šå¿«å–ï¼ˆlocalStorageï¼‰ï¼Œé‡å•Ÿå¾Œ 3 ç§’å…§é¡¯ç¤ºæ•¸å€¼
- [ ] ç„¡ `as any` / `@ts-ignore`ï¼Œé¡å‹å®‰å…¨å®Œæ•´

### è¨­è¨ˆæº–å‰‡
- [ ] å¡ç‰‡åœ¨ 768px ä»¥ä¸‹è‡ªå‹•åˆ‡ mobile ä½ˆå±€ï¼ˆç›´åˆ—ï¼‰
- [ ] çµ±è¨ˆæ•¸å€¼è®ŠåŒ–æ™‚ç„¡ä½ˆå±€è·³å‹•ï¼ˆ`min-width: 60px` å›ºå®šï¼‰
- [ ] Modal èƒŒæ™¯é®ç½© `z-index: 10000`ï¼Œå¯éµç›¤ Esc é—œé–‰
- [ ] æ‰€æœ‰è¡¨å–®æäº¤çš†æœ‰æˆåŠŸ/å¤±æ•— Toast åé¥‹ï¼ˆ3 ç§’æ·¡å‡ºï¼‰

### æ€§èƒ½æº–å‰‡
- [ ] åˆå§‹è¼‰å…¥æ™‚é–“ < 2 ç§’ï¼ˆLighthouse Performance â‰¥ 90ï¼‰
- [ ] åœ–ç‰‡ä½¿ç”¨ lazy loading æˆ– CDN å¿«å–
- [ ] é‡è¤‡è¨ªå®¢ 5 åˆ†é˜å…§ä¸é‡è¤‡è¨ˆç®—ï¼ˆlocalStorage é–æ™‚ï¼‰

### å®‰å…¨æº–å‰‡
- [ ] æ‰€æœ‰è¼¸å…¥çš†ç¶“é `escapeHtml` è½‰ç¾©ï¼ˆé˜² XSSï¼‰
- [ ] `admin_email` åªèƒ½åœ¨ `site_settings` ä¸­ä¿®æ”¹ï¼Œä¸æš´éœ²æ–¼å‰ç«¯
- [ ] Supabase Anon Key ä¸åŒ…å«æ–¼ commitï¼ˆä½¿ç”¨ Secrets/GitHub Variablesï¼‰
